<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="技术改变生活，我的技术和生活。"><title>如何获取 Gopro 视频流 | 昆明鱼</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">如何获取 Gopro 视频流</h1><a id="logo" href="/.">昆明鱼</a><p class="description">一条走在程序路上的小鱼儿</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">如何获取 Gopro 视频流</h1><div class="post-meta">2015-08-31 | </div><span data-thread-key="2015/08/31/Get-gopro-video-stream/" class="ds-thread-count"></span><div class="post-content"><p>前言：最近的工作在研究gopro的视频流如何获取，通过搜索资料，以及对gopro app的抓包分析，得出了以下经验。这次的分析过程也体会到抓包分析的好处，以后还应进一步学习如何用好抓包工具。</p>
<h2 id="u5982_u4F55_u83B7_u53D6Gopro_u7684_u89C6_u9891_u6D41"><a href="#u5982_u4F55_u83B7_u53D6Gopro_u7684_u89C6_u9891_u6D41" class="headerlink" title="如何获取Gopro的视频流"></a>如何获取Gopro的视频流</h2><p>以下的这些url会随gopro的型号版本而有所不同，需要自己抓包分析确定。</p>
<p>gopro提供了wifi和hdmi的视频输出，目前研究的是wifi输出。<br>通过对gopro app抓包分析，和网上搜索的资料，整理出以下方法：</p>
<ol>
<li>先通过gopro app完成和gopro的蓝牙配对，配置好wifi热点，并开启wifi热点；</li>
<li>手机切换至gopro的热点网络，在 udp://:8554 上开启监听。</li>
<li>发送http get request( <a href="http://10.5.5.9/gp/gpExec?p1=gpStreamA9&amp;c1=restart)，gopro即开始向手机的" target="_blank" rel="external">http://10.5.5.9/gp/gpExec?p1=gpStreamA9&amp;c1=restart)，gopro即开始向手机的</a> 8554 端口发送数据。手机即可在udp 8554端口收到数据。</li>
<li>通过抓包分析，gopro app会定期（1次/s）发送心跳请求，维持连接。<br>udp :　“<em>GPHD</em>:1:0:2:0”  0.3次/s  // 若无此心跳，则视频流几秒后会中断<br>http : GET /gp/gpControl/status   2次/s  //若无此心跳，则gopro的wifi热点几分钟后会关闭</li>
</ol>
<p>备注：<br>抓包分析出gopro通信的一些url，响应均为json<br><strong>GET /bacpac/cv</strong> 返回gopro热点名称<br><strong>GET /gp/gpControl</strong> 返回gopro所有设置项的当前状态，可选项信息，以及所有支持的url command<br>如： <strong>/gp/gpControl/command/wireless/pair/cancel</strong> 如果已经配对成功则取消配对</p>
<p>其他包<br>gopro app 会发送mdns请求，获取gopro的ip地址及mac地址等信息；<br>gopro app 每次进入preview界面时，会向全网发送WOL包，WOL（Wake on Lan）局域网唤醒，远程唤醒设备。</p>
<h2 id="u89C6_u9891_u6D41_u683C_u5F0F_uFF0C_u7801_u7387"><a href="#u89C6_u9891_u6D41_u683C_u5F0F_uFF0C_u7801_u7387" class="headerlink" title="视频流格式，码率"></a>视频流格式，码率</h2><p>h.264，aac，mpegts流<br>录制视频：<br>码率范围：20mbps~60mbps<br><a href="http://zh.gopro.com/support/articles/hero4-black-recording-time-in-each-video-setting" target="_blank" rel="external">http://zh.gopro.com/support/articles/hero4-black-recording-time-in-each-video-setting</a></p>
<p>实时预览下码率为：<br>1mbps，帧率为30fps</p>
<h2 id="u4E0A_u4F20_u89C6_u9891"><a href="#u4E0A_u4F20_u89C6_u9891" class="headerlink" title="上传视频"></a>上传视频</h2><p>1、wifi连接gopro，可以通过移动网络传输视频流<br>ios下，可以在连接wifi热点的同时，其他数据通信自动走移动网络通道完成。<br>android，5.0提供了新的网络api，可以给app指定使用特定网络。</p>
</div><div class="tags"></div><div class="post-nav"><a href="/2015/09/22/Can-update-view-in-background-thread/" class="pre"><i class="icon-previous">android 子线程中更新界面？被ProgressBar给迷惑了</i></a><a href="/2015/08/08/组合还是继承/" class="next">组合还是继承<i class="icon-next"></i></a></div><div data-thread-key="2015/08/31/Get-gopro-video-stream/" data-title="如何获取 Gopro 视频流" data-url="http://kmfish.net/2015/08/31/Get-gopro-video-stream/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/08/31/Get-gopro-video-stream/" data-title="如何获取 Gopro 视频流" data-url="http://kmfish.net/2015/08/31/Get-gopro-video-stream/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://kmfish.net"/></form></div><div class="widget"><div class="widget-title">分类</div></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/android/" style="font-size: 15px;">android</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/16/MultiTypeListViewAdapter/">MultiTypeListViewAdapter Android ListView 多type的Adapter封装</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/22/Can-update-view-in-background-thread/">android 子线程中更新界面？被ProgressBar给迷惑了</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/31/Get-gopro-video-stream/">如何获取 Gopro 视频流</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/08/组合还是继承/">组合还是继承</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/21/Why use fragment/">Why use fragment？</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/09/08/?p=14/">android camera 摄像头预览画面变形</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title">友情链接</div></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">昆明鱼.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'kmfish'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script></div></body></html>